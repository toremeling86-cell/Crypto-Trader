# Gitleaks Configuration (TODO 7 - Secrets Scanning)
# https://github.com/gitleaks/gitleaks

title = "CryptoTrader Secrets Detection"

# Allowlist paths that contain test fixtures or example credentials
[allowlist]
description = "Allowlist for test files and examples"
paths = [
    '''\.env\.example$''',
    '''gradle\.properties\.example$''',
    '''test.*\.kt$''',
    '''Test.*\.kt$''',
    '''.*test_.*\.log$''',
    '''sample_data/.*'''
]

# Allowlist specific strings that are known to be safe
regexes = [
    '''sk-ant-test-[a-zA-Z0-9-_]{95}''',  # Test API keys
    '''AKIAIOSFODNN7EXAMPLE''',           # AWS example credentials
    '''wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY''',  # AWS example secret
    '''-----BEGIN FAKE CERTIFICATE-----''',  # Test certificates
]

# Allowlist commits (if needed for legacy)
# commits = [ "commit-hash-here" ]

# Custom rules for CryptoTrader project
[[rules]]
id = "kraken-api-key"
description = "Kraken API Key"
regex = '''(?i)(kraken[_-]?api[_-]?key)\s*[:=]\s*['"]?([a-zA-Z0-9+/]{56})['"]?'''
secretGroup = 2
keywords = [
    "kraken",
    "api-key",
    "api_key"
]

[[rules]]
id = "kraken-private-key"
description = "Kraken Private Key"
regex = '''(?i)(kraken[_-]?private[_-]?key)\s*[:=]\s*['"]?([a-zA-Z0-9+/]{88}==)['"]?'''
secretGroup = 2
keywords = [
    "kraken",
    "private-key",
    "private_key"
]

[[rules]]
id = "anthropic-api-key"
description = "Anthropic Claude API Key"
regex = '''sk-ant-api03-[a-zA-Z0-9-_]{95}'''
keywords = [
    "sk-ant-api",
    "claude",
    "anthropic"
]

[[rules]]
id = "cloudflare-r2-access-key"
description = "Cloudflare R2 Access Key ID"
regex = '''(?i)(r2[_-]?access[_-]?key[_-]?id|access[_-]?key[_-]?id)\s*[:=]\s*['"]?([A-Z0-9]{20})['"]?'''
secretGroup = 2
keywords = [
    "r2_access",
    "access_key_id",
    "cloudflare"
]

[[rules]]
id = "cloudflare-r2-secret-key"
description = "Cloudflare R2 Secret Access Key"
regex = '''(?i)(r2[_-]?secret[_-]?access[_-]?key|secret[_-]?access[_-]?key)\s*[:=]\s*['"]?([a-zA-Z0-9+/]{40})['"]?'''
secretGroup = 2
keywords = [
    "r2_secret",
    "secret_access_key",
    "cloudflare"
]

[[rules]]
id = "generic-api-key"
description = "Generic API Key"
regex = '''(?i)(api[_-]?key|apikey)\s*[:=]\s*['"]?([a-zA-Z0-9]{32,})['"]?'''
secretGroup = 2
keywords = [
    "api-key",
    "api_key",
    "apikey"
]

[[rules]]
id = "private-key-block"
description = "Private Key Block"
regex = '''-----BEGIN (RSA|DSA|EC|OPENSSH) PRIVATE KEY-----'''
keywords = [
    "-----BEGIN",
    "PRIVATE KEY-----"
]

[[rules]]
id = "generic-password"
description = "Generic Password (high entropy)"
regex = '''(?i)(password|passwd|pwd)\s*[:=]\s*['"]?([a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]{12,})['"]?'''
secretGroup = 2
keywords = [
    "password",
    "passwd",
    "pwd"
]
entropy = 3.5  # Require high entropy to avoid false positives

# Additional generic secret detection
[[rules]]
id = "generic-secret"
description = "Generic Secret (high entropy)"
regex = '''(?i)(secret|token|auth)\s*[:=]\s*['"]?([a-zA-Z0-9+/]{40,})['"]?'''
secretGroup = 2
keywords = [
    "secret",
    "token",
    "auth"
]
entropy = 4.0

# AWS credentials
[[rules]]
id = "aws-access-key"
description = "AWS Access Key"
regex = '''(A3T[A-Z0-9]|AKIA|AGPA|AIDA|AROA|AIPA|ANPA|ANVA|ASIA)[A-Z0-9]{16}'''
keywords = [
    "aws",
    "access",
    "key"
]

[[rules]]
id = "aws-secret-key"
description = "AWS Secret Key"
regex = '''(?i)aws.{0,20}?(?:key|pwd|pw|password|pass|token)(?:[^a-zA-Z0-9+\/]){0,5}([a-zA-Z0-9+\/]{40})'''
secretGroup = 1
keywords = [
    "aws",
    "secret"
]

# GitHub tokens
[[rules]]
id = "github-token"
description = "GitHub Personal Access Token"
regex = '''ghp_[0-9a-zA-Z]{36}'''
keywords = [
    "ghp_",
    "github",
    "token"
]

[[rules]]
id = "github-oauth"
description = "GitHub OAuth Access Token"
regex = '''gho_[0-9a-zA-Z]{36}'''
keywords = [
    "gho_",
    "github",
    "oauth"
]

# Database connection strings
[[rules]]
id = "connection-string"
description = "Database Connection String with Password"
regex = '''(?i)(jdbc|mysql|postgresql|mongodb):\/\/[^:]+:([^@]{8,})@'''
secretGroup = 2
keywords = [
    "jdbc",
    "mysql",
    "postgresql",
    "mongodb"
]

# Private keys in JSON
[[rules]]
id = "json-web-token"
description = "JSON Web Token (JWT)"
regex = '''eyJ[A-Za-z0-9-_=]+\.eyJ[A-Za-z0-9-_=]+\.?[A-Za-z0-9-_.+/=]*'''
keywords = [
    "eyJ",
    "jwt",
    "token"
]

[allowlist.stopwords]
stopwords = [
    "example",
    "test",
    "fake",
    "demo",
    "sample",
    "placeholder",
    "your-api-key-here",
    "your_api_key_here",
    "INSERT_YOUR_KEY_HERE"
]
